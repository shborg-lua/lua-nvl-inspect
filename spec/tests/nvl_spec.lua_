local assert = assert
---@cast assert -function,+nvl.test.luassert

---
---@param nvl any
---@param expect any
local function validate_package(nvl, expect)
	local pkg = nvl[expect.name]
	assert.Table(nvl)
	assert.Table(pkg)
	assert.equal(expect.name, pkg.name)

	assert.String(pkg.path)
	assert(pkg.path:find("lua%-nvl%-" .. expect.name))

	assert.Table(pkg.config)
	assert.Function(pkg.config.setup)
	local module = pkg.module
	P({
		"SETUP----------------",
		module = module,
	})
	assert.Table(pkg.module)
end

describe("#unit #nvl", function()
	describe("nvl exports", function()
		local nvl = require("nvl")

		local packages = {
			inspect = false,
			-- utils = false,
		}
		for package_name, _ in pairs(packages) do
			it("exports package '" .. package_name .. "'", function()
				validate_package(nvl, {
					name = package_name,
				})
			end)
		end
	end)
end)
